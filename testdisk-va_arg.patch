--- src/testdisk.c~	Sat Nov 16 17:10:59 2002
+++ src/testdisk.c	Sat Nov 16 17:29:43 2002
@@ -48,9 +48,12 @@
 int ecrit_rapport(const char *_format, ...)
 {
   int res=0;
+  va_list ap;
   if(f_rapport)
   {
-    res=vfprintf(f_rapport,_format,(va_list)(&_format+1));
+    va_start(ap,_format);
+    res=vfprintf(f_rapport,_format,ap);
+    va_end(ap);
     fflush(f_rapport);
   }
   return res;
@@ -59,6 +62,7 @@
 int doprintf(const char *_format, ...)
 {
   char res[800];
+  va_list ap;
 #ifdef DEBUG
   if(f_rapport)
     vfprintf(f_rapport,_format,(&_format+1));
@@ -66,7 +70,9 @@
 #ifdef DJGPP
   vsprintf(res,_format,(&_format+1));
 #else
-  vsnprintf(res,sizeof(res),_format,(va_list)(&_format+1));
+  va_start(ap,_format);
+  vsnprintf(res,sizeof(res),_format,ap);
+  va_end(ap);
 #endif
   return addstr(res);
 }
@@ -74,6 +80,7 @@
 int wdoprintf(WINDOW *window, const char *_format, ...)
 {
   char res[800];
+  va_list ap;
 #ifdef DEBUG
   if(f_rapport)
     vfprintf(f_rapport,_format,(&_format+1));
@@ -81,7 +88,9 @@
 #ifdef DJGPP
   vsprintf(res,_format,(&_format+1));
 #else
-  vsnprintf(res,sizeof(res),_format,(va_list)(&_format+1));
+  va_start(ap,_format);
+  vsnprintf(res,sizeof(res),_format,ap);
+  va_end(ap);
 #endif
   return waddstr(window,res);
 }
--- src/intrface.c~	Sun Jul 21 20:51:28 2002
+++ src/intrface.c	Sat Nov 16 17:38:33 2002
@@ -1112,13 +1112,16 @@
 	  {
 		char tmp_line[BUFFER_LINE_LENGTH+1];
 		char *pos_in_tmp_line=tmp_line-1;
+		va_list ap;
 		memset(tmp_line,'\0',sizeof(tmp_line));
 #ifdef DJGPP
 		if(strlen(_format)>sizeof(tmp_line))
 		  ecrit_rapport("\nBUG: %s\n",_format);
 		vsprintf(tmp_line,_format,(&_format)+1);
 #else
-		vsnprintf(tmp_line,BUFFER_LINE_LENGTH,_format,(va_list)(&_format+1));
+		va_start(ap,_format);
+		vsnprintf(tmp_line,BUFFER_LINE_LENGTH,_format,ap);
+		va_end(ap);
 #endif
 		while(pos_in_tmp_line && (nbr_lines<MAX_LINES))
 		{
